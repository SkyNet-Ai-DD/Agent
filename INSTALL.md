# Подробные инструкции по установке и настройке мета-агента

## Введение

Мета-агент - это интеллектуальная система автоматизации, построенная на платформе n8n, которая использует передовые технологии искусственного интеллекта для решения сложных инженерных задач в области машиностроения. Система способна автоматически классифицировать запросы пользователей, генерировать техническую документацию, создавать чертежи в САПР и предоставлять интеллектуальные консультации на основе базы знаний стандартов.

Это руководство содержит пошаговые инструкции по установке и настройке всех компонентов мета-агента.

## Системные требования

Для успешной установки и работы мета-агента требуются следующие компоненты:

### Обязательные компоненты:
- **n8n** - платформа оркестрации рабочих процессов (версия 1.0 или выше)
- **Система управления базами данных** - PostgreSQL (версия 12 или выше) или Google Sheets для структурированных данных
- **Векторная база данных** - Qdrant или Pinecone для хранения embeddings стандартов и технической литературы
- **Хранилище файлов** - Google Drive или Nextcloud для хранения документов и чертежей
- **Telegram Bot** - для взаимодействия с пользователями через мессенджер

### Опциональные компоненты:
- **САПР** - AutoCAD (версия 2020 или выше) и/или SolidWorks (версия 2020 или выше) для автоматизации чертежных работ
- **Системы управления данными** - Teamcenter или Windchill для интеграции с корпоративными PDM/PLM системами
- **Крупные языковые модели** - DeepSeek V3, Qwen через провайдера PPIO, OpenAI GPT-4o

### Аппаратные требования:
- **Процессор**: 4 ядра или больше
- **Оперативная память**: 16 ГБ или больше
- **Дисковое пространство**: 50 ГБ свободного места
- **Операционная система**: Linux (рекомендуется), Windows 10/11, macOS 10.14 или выше

## Установка n8n

n8n является центральной платформой для оркестрации всех компонентов мета-агента. Ниже приведены инструкции по установке n8n.

### Вариант 1: Установка через npm (рекомендуется для разработки)

1. Убедитесь, что на вашей системе установлен Node.js (версия 18 или выше) и npm:
   ```bash
   node --version
   npm --version
   ```

2. Установите n8n глобально:
   ```bash
   npm install n8n -g
   ```

3. Запустите n8n:
   ```bash
   n8n
   ```

4. Откройте веб-браузер и перейдите по адресу `http://localhost:5678` для доступа к интерфейсу n8n.

### Вариант 2: Установка через Docker (рекомендуется для продакшена)

1. Убедитесь, что на вашей системе установлен Docker:
   ```bash
   docker --version
   ```

2. Запустите n8n с помощью Docker:
   ```bash
   docker run -it --rm \
     --name n8n \
     -p 5678:5678 \
     -v ~/.n8n:/home/node/.n8n \
     n8nio/n8n
   ```

3. Для запуска в фоновом режиме добавьте флаг `-d`:
   ```bash
   docker run -d --rm \
     --name n8n \
     -p 5678:5678 \
     -v ~/.n8n:/home/node/.n8n \
     n8nio/n8n
   ```

### Вариант 3: Установка через Docker Compose (для продакшена с дополнительными сервисами)

1. Создайте файл `docker-compose.yml`:
   ```yaml
   version: '3.8'
   services:
     n8n:
       image: n8nio/n8n
       restart: unless-stopped
       ports:
         - "5678:5678"
       environment:
         - N8N_BASIC_AUTH_ACTIVE=true
         - N8N_BASIC_AUTH_USER
         - N8N_BASIC_AUTH_PASSWORD
       volumes:
         - ./n8n_data:/home/node/.n8n
   ```

2. Запустите n8n:
   ```bash
   docker-compose up -d
   ```

### Первоначальная настройка n8n

1. После запуска n8n откройте веб-интерфейс по адресу `http://localhost:5678`.

2. Создайте учетную запись администратора, следуя инструкциям на экране.

3. Настройте безопасность:
   - Включите аутентификацию в настройках безопасности
   - Настройте HTTPS при необходимости
   - Ограничьте доступ к интерфейсу n8n

4. Установите необходимые ноды:
   - Перейдите в раздел "Settings" -> "Nodes"
   - Установите дополнительные ноды, если они требуются для интеграции с внешними системами

### Настройка переменных окружения

Для безопасного хранения ключей API и других конфиденциальных данных рекомендуется использовать переменные окружения:

1. Создайте файл `.env` в директории n8n:
   ```env
   TELEGRAM_BOT_TOKEN=ваш_токен_бота
   OPENAI_API_KEY=ваш_api_ключ_openai
   VECTOR_DB_URL=адрес_вашей_векторной_бд
   VECTOR_DB_API_KEY=api_ключ_векторной_бд
   ```

2. Загрузите переменные окружения в n8n:
   - Перейдите в раздел "Settings" -> "Environment Variables"
   - Добавьте необходимые переменные

## Настройка интеграции с LLM

Мета-агент использует несколько крупных языковых моделей для решения различных задач. Ниже приведены инструкции по настройке интеграции с каждой из них.

### DeepSeek V3

1. Получите API ключ для доступа к DeepSeek V3 (если доступен).

2. В n8n:
   - Перейдите в раздел "Settings" -> "AI"
   - Добавьте новую модель AI
   - Выберите "Custom Model"
   - Введите параметры подключения к API DeepSeek

### Qwen через провайдера PPIO

1. Зарегистрируйтесь на платформе PPIO и получите API ключ.

2. В n8n:
   - Перейдите в раздел "Settings" -> "AI"
   - Добавьте новую модель AI
   - Выберите "Custom Model"
   - Введите параметры подключения к API PPIO

### OpenAI GPT-4o

1. Получите API ключ от OpenAI:
   - Перейдите на сайт https://platform.openai.com/
   - Создайте учетную запись или войдите в существующую
   - Перейдите в раздел "API Keys"
   - Создайте новый API ключ

2. В n8n:
   - Перейдите в раздел "Settings" -> "AI"
   - Добавьте новую модель AI
   - Выберите "OpenAI"
   - Введите ваш API ключ

### Настройка системных промптов

Для каждой модели и типа задач необходимо настроить соответствующие системные промпты:

1. В n8n перейдите в раздел "Settings" -> "AI" -> "Prompts"

2. Добавьте промпты для различных типов задач:
   - Промпт для технических вопросов
   - Промпт для генерации документации
   - Промпт для извлечения параметров

Пример промпта для технических вопросов:
```
Ты инженер-консультант в области машиностроения. Используй только предоставленную документацию: [контекст]. Ответь на вопрос: [вопрос пользователя]. При генерации ответа строго следуй следующим правилам:
1. Используй терминологию ГОСТ и техническую специфику машиностроения
2. Ссылайся на конкретные разделы стандартов и документации
3. Не добавляй информацию, не содержащуюся в предоставленном контексте
4. Если в контексте нет достаточной информации, честно об этом сообщи
```

## Подготовка баз знаний стандартов

Для эффективной работы мета-агента необходимо создать структурированную базу знаний стандартов (ГОСТ, СНиП и др.).

### Вариант 1: Векторная база данных (Qdrant или Pinecone)

#### Преимущества:
- Семантический поиск по смыслу запроса
- Возможность находить релевантные стандарты даже по частично совпадающим ключевым словам
- Высокая точность поиска при работе с технической документацией

#### Подготовка данных:

1. Сбор текстов стандартов:
   - Получите официальные тексты стандартов из авторитетных источников
   - Убедитесь в наличии прав на использование материалов

2. Предобработка текста:
   - Очистите тексты от лишних символов и форматирования
   - Разбейте тексты на логические разделы или chunks подходящего размера

3. Генерация embeddings:
   - Используйте модель embeddings для генерации векторных представлений текстов
   - Сохраните тексты и их векторные представления

4. Загрузка в векторную базу данных:
   - Настройте подключение к Qdrant или Pinecone
   - Загрузите данные в базу

#### Интеграция с n8n:
1. Установите соответствующую ноду для работы с векторной базой данных
2. Настройте параметры подключения в переменных окружения
3. Создайте workflow для поиска по базе знаний

### Вариант 2: Реляционная база данных (PostgreSQL) или Google Sheets

#### Преимущества:
- Простота реализации и поддержки
- Четкая структура данных
- Легкость интеграции с n8n через готовые ноды

#### Подготовка данных:

1. Создание структуры таблицы в PostgreSQL:
   ```sql
   CREATE TABLE standards (
     id SERIAL PRIMARY KEY,
     number VARCHAR(50),
     name TEXT,
     category VARCHAR(100),
     keywords TEXT[],
     description TEXT,
     link VARCHAR(200)
   );
   ```

2. Или создайте таблицу в Google Sheets со следующими колонками:
   - Номер стандарта
   - Название стандарта
   - Категория
   - Ключевые слова
   - Описание
   - Ссылка на документ

3. Заполнение данными:
   - Вручную или с помощью скриптов внесите данные по стандартам
   - Проиндексируйте поля для ускорения поиска

#### Интеграция с n8n:
1. Установите ноду PostgreSQL или Google Sheets
2. Настройте параметры подключения
3. Создайте workflow для выполнения SQL-запросов или работы с Google Sheets

## Настройка интеграции с CAD системами

Мета-агент может интегрироваться с САПР для автоматизации чертежных работ.

### AutoCAD

#### Требования:
- AutoCAD 2020 или выше
- Включенный HTTP-сервер (если используется HTTP-интеграция)

#### Настройка:

1. Подготовка сервера AutoCAD:
   - Установите AutoCAD на отдельный компьютер или сервер
   - Настройте HTTP-интерфейс для приема команд

2. Генерация AutoLISP скриптов:
   - Создайте шаблоны скриптов для типовых задач
   - Настройте параметризацию скриптов

3. Интеграция с n8n:
   - Используйте ноду HTTP Request для отправки команд
   - Настройте обработку результатов выполнения скриптов

### SolidWorks

#### Требования:
- SolidWorks 2020 или выше
- Включенный API сервер (если используется HTTP-интеграция)

#### Настройка:

1. Подготовка сервера SolidWorks:
   - Установите SolidWorks на отдельный компьютер или сервер
   - Настройте HTTP-интерфейс для приема команд

2. Генерация макросов:
   - Создайте шаблоны VBA-макросов для типовых задач
   - Настройте параметризацию макросов

3. Интеграция с n8n:
   - Используйте ноду HTTP Request для отправки команд
   - Настройте обработку результатов выполнения макросов

## Запуск рабочих процессов

После установки и настройки всех компонентов необходимо запустить рабочие процессы мета-агента.

### Импорт workflows

1. Перейдите в интерфейс n8n
2. Выберите "Workflows" -> "Import"
3. Импортируйте файлы workflows из директории `workflows/` проекта:
   - `basic_request_processing.json` - базовый workflow обработки запросов
   - `technical_questions.json` - workflow для ответов на технические вопросы
   - `engineering_documentation.json` - workflow для генерации документации
   - `memory_context.json` - workflow для управления контекстом диалога

### Настройка workflows

1. После импорта каждого workflow проверьте и при необходимости обновите:
   - Параметры подключения к внешним системам
   - Переменные окружения
   - Пути к файлам и ресурсам

2. Активируйте workflows:
   - Переключите тумблер "Active" в положение "On" для каждого workflow
   - Убедитесь, что все зависимости корректно настроены

### Тестирование

1. Выполните тестовый запуск каждого workflow:
   - Используйте встроенные функции тестирования n8n
   - Проверьте корректность обработки различных типов запросов

2. Проверьте интеграцию с внешними системами:
   - Убедитесь в корректной работе с Telegram ботом
   - Проверьте генерацию документов и чертежей
   - Протестируйте поиск по базе знаний стандартов

## Устранение неполадок

### Проблемы с запуском n8n

**Симптом**: n8n не запускается или не открывается веб-интерфейс
**Решение**:
1. Проверьте, что порт 5678 не занят другим приложением:
   ```bash
   netstat -an | grep 5678
   ```
2. Убедитесь, что брандмауэр не блокирует порт 5678
3. Проверьте логи n8n на наличие ошибок

### Проблемы с интеграцией LLM

**Симптом**: Модели AI не отвечают или возвращают ошибки
**Решение**:
1. Проверьте правильность API ключей в переменных окружения
2. Убедитесь, что есть доступ к интернету
3. Проверьте квоты использования API у провайдера
4. Проверьте логи n8n на наличие ошибок интеграции

### Проблемы с базой знаний

**Симптом**: Поиск по стандартам не возвращает результаты или возвращает некорректные результаты
**Решение**:
1. Проверьте подключение к базе данных
2. Убедитесь, что данные корректно загружены
3. Проверьте параметры поиска и индексации
4. При использовании векторной базы данных проверьте корректность embeddings

### Проблемы с интеграцией CAD

**Симптом**: Не удается создать чертежи в AutoCAD или SolidWorks
**Решение**:
1. Проверьте, что CAD-система запущена и доступна по сети
2. Убедитесь, что HTTP-интерфейс CAD-системы корректно настроен
3. Проверьте правильность сгенерированных скриптов или макросов
4. Проверьте логи CAD-системы наличие ошибок выполнения

## Заключение

После выполнения всех шагов, описанных в этом руководстве, мета-агент должен быть полностью установлен и настроен для работы. Система готова к решению инженерных задач, автоматизации документооборота и предоставлению интеллектуальных консультаций.

Регулярно обновляйте базу знаний стандартов и следите за новыми версиями компонентов системы для обеспечения стабильной и эффективной работы мета-агента.